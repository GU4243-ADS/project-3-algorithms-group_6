---
title: "main_memory"
author: "Huijun Cui"
date: "April 8, 2018"
output: html_document
---
```{R}
rm(list=ls())
```
```{r setup, include=FALSE}
setwd("../lib")
source("functions.R")
```
```{r}
load("../data/movie_train.RData")
load("../data/movie_test.RData")
load("../data/MS_train.RData")
load("../data/MS_test.RData")
```
## similarity weights
### Calculate pearson correlation
```{r}
weight_pearson_MS_train <- calc_weight(MS_UI, method = 'pearson')
save(weight_pearson_MS_train, file = 'weight_pearson_MS_train.RData')

weight_pearson_movie_train <- calc_weight(movie_UI, method = 'pearson')
save(weight_pearson_movie_train, file = 'weight_pearson_movie_train.RData')

### Calculate spearman correlation

weight_spearman_MS_train <- calc_weight(MS_UI, method = 'spearman')
save(weight_spearman_MS_train, file = 'weight_spearman_MS_train.RData')

weight_spearman_movie_train <- calc_weight(movie_UI, method = 'spearman')
save(weight_spearman_movie_train, file = 'weight_spearman_movie_train.RData')
```
### Calculate cosine correlation
```{r}
weight_cosine_MS_train <- calc_weight(MS_UI, method = 'cosine')
save(weight_cosine_MS_train, file = 'weight_cosine_MS_train.RData')

weight_cosine_movie_train <- calc_weight(movie_UI, method = 'cosine')
save(weight_cosine_movie_train, file = 'weight_cosine_movie_train.RData')
```
### Calculate entropy correlation
```{r}
weight_entropy_MS_train <- calc_weight(MS_UI, method = 'entropy')
save(weight_entropy_MS_train, file = 'weight_entropy_MS_train.RData')
```
```{r}
weight_entropy_movie_train <- calc_weight(movie_UI, method = 'entropy')
save(weight_entropy_movie_train, file = 'weight_entropy_movie_train.RData')
```
### Calculate mean-square difference correlation
```{r}
weight_msd_MS_train <- calc_weight(MS_UI, method = 'msd')
save(weight_msd_MS_train, file = 'weight_msd_MS_train.RData')
```
```{r}
weight_msd_movie_train <- calc_weight(movie_UI, method = 'msd')
save(weight_msd_movie_train, file = 'weight_msd_movie_train.RData')
```
## Prediction
### Load similarity weights
```{r}
load("../output/weight_pearson_MS_train.RData")
load("../output/weight_pearson_movie_train.RData")
load("../output/weight_spearman_MS_train.RData")
load("../output/weight_spearman_movie_train.RData")
load("../output/weight_cosine_MS_train.RData")
load("../output/weight_cosine_movie_train.RData")
load("../output/weight_entropy_MS_train.RData")
load("../output/weight_entropy_movie_train.RData")
load("../output/weight_msd_MS_train.RData")
load("../output/weight_msd_movie_train.Rdata")
load("../output/weight_cosine_MS_train.RData")
```

### Original Prediction
#### With Pearson correlation
```{r web predict}
# Calculate predictions for MS
MS_pred_pearson <- pred_matrix(MS_UI, weight_pearson_MS_train)
save(MS_pred_pearson, file = "../output/MS_pred_pearson.RData")

movie_pred_pearson <- pred_matrix(movie_UI, weight_pearson_movie_train)
save(movie_pred_pearson, file = "../output/movie_pred_pearson.RData")
```
#### With Spearman correlation
```{r web predict}
# Calculate predictions for MS
MS_pred_spearman <- pred_matrix(MS_UI, weight_spearman_MS_train)
save(MS_pred_spearman, file = "../output/MS_pred_spearman.RData")

movie_pred_spearman <- pred_matrix(movie_UI, weight_spearman_movie_train)
save(movie_pred_spearman, file = "../output/movie_pred_spearman.RData")
```
#### With Cosine correlation
```{r web predict}
# Calculate predictions for MS
MS_pred_cosine <- pred_matrix(MS_UI, weight_cosine_MS_train)
save(MS_pred_cosine, file = "../output/MS_pred_cosine.RData.RData")

movie_pred_cosine <- pred_matrix(movie_UI, weight_cosine_movie_train)
save(movie_pred_cosine, file = "../output/movie_pred_cosine.RData")
```
#### With mean-square difference correlation
```{r web predict}
# Calculate predictions for MS
MS_pred_msd <- pred_matrix(MS_UI, weight_msd_MS_train)
save(MS_pred_msd, file = "../output/MS_pred_msd.RData")

movie_pred_msd <- pred_matrix(movie_UI, weight_msd_movie_train)
save(movie_pred_msd, file = "../output/movie_pred_msd.RData")
```
#### With Entropy correlation
```{r web predict}
# Calculate predictions for MS
MS_pred_entropy <- pred_matrix(MS_UI, weight_entropy_MS_train)
save(MS_pred_entropy, file = "../output/MS_pred_entropy.RData")

movie_pred_entropy <- pred_matrix(movie_UI, weight_entropy_movie_train)
save(movie_pred_entropy, file = "../output/movie_pred_entropy.RData")
```

### Z-Score Prediction
#### With Pearson correlation
```{r web predict}
# Calculate predictions for MS
MS_pred_pearson <- pred_z_score_matrix(MS_UI, weight_pearson_MS_train)
save(MS_pred_pearson, file = "../output/MS_pred_pearson.RData")

movie_pred_pearson <- pred_z_score_matrix(movie_UI, weight_pearson_movie_train)
save(movie_pred_pearson, file = "../output/movie_pred_pearson.RData")
```
#### With Spearman correlation
```{r web predict}
# Calculate predictions for MS
MS_pred_spearman <- pred_z_score_matrix(MS_UI, weight_spearman_MS_train)
save(MS_pred_spearman, file = "../output/MS_pred_spearman.RData")

movie_pred_spearman <- pred_z_score_matrix(movie_UI, weight_spearman_movie_train)
save(movie_pred_spearman, file = "../output/movie_pred_spearman.RData")
```
#### With Cosine correlation
```{r web predict}
# Calculate predictions for MS
MS_pred_cosine <- pred_z_score_matrix(MS_UI, weight_cosine_MS_train)
save(MS_pred_cosine, file = "../output/MS_pred_cosine.RData.RData")

movie_pred_cosine <- pred_z_score_matrix(movie_UI, weight_cosine_movie_train)
save(movie_pred_cosine, file = "../output/movie_pred_cosine.RData")
```
#### With mean-square difference correlation
```{r web predict}
# Calculate predictions for MS
MS_pred_msd_zscore <- pred_z_score_matrix(MS_UI, weight_msd_MS_train)
save(MS_pred_msd_zscore, file = "../output/MS_pred_msd_zscore.RData")

movie_pred_msd_zscore <- pred_z_score_matrix(movie_UI, weight_msd_movie_train)
save(movie_pred_msd_zscore, file = "../output/movie_pred_msd_zscore.RData")
```
#### With Entropy correlation
```{r web predict}
# Calculate predictions for MS
MS_pred_entropy_zscore <- pred_z_score_matrix(MS_UI, weight_entropy_MS_train)
save(MS_pred_entropy_zscore, file = "../output/MS_pred_entropy_zscore.RData")

movie_pred_entropy_zscore <- pred_z_score_matrix(movie_UI, weight_entropy_movie_train)
save(movie_pred_entropy_zscore, file = "../output/movie_pred_entropy_zscore.RData")
```
## Evaluation
### Load prediction data
```{r}
load("../output/movie_pred_entropy_zscore.RData")
load("../output/MS_pred_entropy_zscore.RData")
load("../output/movie_pred_msd_zscore.RData")
load("../output/MS_pred_msd_zscore.RData")
load("../output/movie_pred_cosine_zscore.RData")
load("../output/MS_pred_cosine_zscore.RData")
load("../output/movie_pred_spearman_zscore.RData")
load("../output/MS_pred_spearman_zscore.RData")
load("../output/movie_pred_pearson_zscore.RData")
load("../output/MS_pred_pearson_zscore.RData")
load("../output/movie_pred_entropy.RData")
load("../output/MS_pred_entropy.RData")
load("../output/movie_pred_msd.RData")
load("../output/MS_pred_msd.RData")
load("../output/movie_pred_cosine.RData")
load("../output/MS_pred_cosine.RData")
load("../output/movie_pred_spearman.RData")
load("../output/MS_pred_spearman.RData")
load("../output/movie_pred_pearson.RData")
load("../output/MS_pred_pearson.RData")
```
### Original Memory-based Model
#### Pearson Correlation
```{r}
# Rank of Score for Web
MS_pred<-MS_pred_pearson
MS_pred<-MS_pred[rownames(MS_test),colnames(MS_test)]
rank_score_pearson = rank_score(MS_test,MS_pred)
rank_score_pearson
# Web Accuracy 
# percent of vroot user visit in test data
sum(MS_test)/(dim(MS_test)[1]*dim(MS_test)[2])
# percent of vroot user visit in pred data
sum(MS_pred)/(dim(MS_pred)[1]*dim(MS_pred)[2])
# percent of vroot that the model predict and the user actually visit
sum((MS_test==MS_pred) & (MS_test==1))/sum(MS_test==1)
# MAE for Movie
movie_pred<-movie_pred_pearson
movie_pred<-movie_pred[rownames(movie_UI_test),colnames(movie_UI_test)]
mae(movie_UI_test,movie_pred)
```
#### Spearman Correlation
```{r}
# Rank of Score for Web
MS_pred<-MS_pred_spearman
MS_pred<-MS_pred[rownames(MS_test),colnames(MS_test)]
rank_score_spearman = rank_score(MS_test,MS_pred)
rank_score_spearman
# Web Accuracy 
# percent of vroot user visit in test data
sum(MS_test)/(dim(MS_test)[1]*dim(MS_test)[2])
# percent of vroot user visit in pred data
sum(MS_pred)/(dim(MS_pred)[1]*dim(MS_pred)[2])
# percent of vroot that the model predict and the user actually visit
sum((MS_test==MS_pred) & (MS_test==1))/sum(MS_test==1)
# MAE for Movie
movie_pred<-movie_pred_spearman
movie_pred<-movie_pred[rownames(movie_UI_test),colnames(movie_UI_test)]
mae(movie_UI_test,movie_pred)
```
#### Cosine Correlation
```{r}
# Rank of Score for Web
MS_pred<-MS_pred_cosine
MS_pred<-MS_pred[rownames(MS_test),colnames(MS_test)]
rank_score_cosine = rank_score(MS_test,MS_pred)
rank_score_cosine
# Web Accuracy 
# percent of vroot user visit in test data
sum(MS_test)/(dim(MS_test)[1]*dim(MS_test)[2])
# percent of vroot user visit in pred data
sum(MS_pred)/(dim(MS_pred)[1]*dim(MS_pred)[2])
# percent of vroot that the model predict and the user actually visit
sum((MS_test==MS_pred) & (MS_test==1))/sum(MS_test==1)
# MAE for Movie
movie_pred<-movie_pred_cosine
movie_pred<-movie_pred[rownames(movie_UI_test),colnames(movie_UI_test)]
mae(movie_UI_test,movie_pred)
```
#### mean-square difference Correlation
```{r}
# Rank of Score for Web
MS_pred<-MS_pred_msd
MS_pred<-MS_pred[rownames(MS_test),colnames(MS_test)]
rank_score_msd = rank_score(MS_test,MS_pred)
rank_score_msd
# Web Accuracy 
# percent of vroot user visit in test data
sum(MS_test)/(dim(MS_test)[1]*dim(MS_test)[2])
# percent of vroot user visit in pred data
sum(MS_pred)/(dim(MS_pred)[1]*dim(MS_pred)[2])
# percent of vroot that the model predict and the user actually visit
sum((MS_test==MS_pred) & (MS_test==1))/sum(MS_test==1)
# MAE for Movie
movie_pred<-movie_pred_msd
movie_pred<-movie_pred[rownames(movie_UI_test),colnames(movie_UI_test)]
mae(movie_UI_test,movie_pred)
```
#### Entropy Correlation
```{r}
# Rank of Score for Web
MS_pred<-MS_pred_entropy
MS_pred<-MS_pred[rownames(MS_test),colnames(MS_test)]
rank_score_entropy = rank_score(MS_test,MS_pred)
rank_score_entropy
# Web Accuracy 
# percent of vroot user visit in test data
sum(MS_test)/(dim(MS_test)[1]*dim(MS_test)[2])
# percent of vroot user visit in pred data
sum(MS_pred)/(dim(MS_pred)[1]*dim(MS_pred)[2])
# percent of vroot that the model predict and the user actually visit
sum((MS_test==MS_pred) & (MS_test==1))/sum(MS_test==1)
# MAE for Movie
movie_pred<-movie_pred_entropy
movie_pred<-movie_pred[rownames(movie_UI_test),colnames(movie_UI_test)]
mae(movie_UI_test,movie_pred)
```
### Z-score Memory-based Model
#### Pearson Correlation
```{r}
# Rank of Score for Web
MS_pred<-MS_pred_pearson_zscore
MS_pred<-MS_pred[rownames(MS_test),colnames(MS_test)]
rank_score_pearson_zscore = rank_score(MS_test,MS_pred)
rank_score_pearson_zscore
# Web Accuracy 
# percent of vroot user visit in test data
sum(MS_test)/(dim(MS_test)[1]*dim(MS_test)[2])
# percent of vroot user visit in pred data
sum(MS_pred)/(dim(MS_pred)[1]*dim(MS_pred)[2])
# percent of vroot that the model predict and the user actually visit
sum((MS_test==MS_pred) & (MS_test==1))/sum(MS_test==1)
# MAE for Movie
movie_pred<-movie_pred_pearson_zscore
movie_pred<-movie_pred[rownames(movie_UI_test),colnames(movie_UI_test)]
mae(movie_UI_test,movie_pred)
```
#### Spearman Correlation
```{r}
# Rank of Score for Web
MS_pred<-MS_pred_spearman_zscore
MS_pred<-MS_pred[rownames(MS_test),colnames(MS_test)]
rank_score_spearman_zscore = rank_score(MS_test,MS_pred)
rank_score_spearman_zscore
# Web Accuracy 
# percent of vroot user visit in test data
sum(MS_test)/(dim(MS_test)[1]*dim(MS_test)[2])
# percent of vroot user visit in pred data
sum(MS_pred)/(dim(MS_pred)[1]*dim(MS_pred)[2])
# percent of vroot that the model predict and the user actually visit
sum((MS_test==MS_pred) & (MS_test==1))/sum(MS_test==1)
# MAE for Movie
movie_pred<-movie_pred_spearman_z_score
movie_pred<-movie_pred[rownames(movie_UI_test),colnames(movie_UI_test)]
mae(movie_UI_test,movie_pred)
```
#### Cosine Correlation
```{r}
# Rank of Score for Web
MS_pred<-MS_pred_cosine_zscore
MS_pred<-MS_pred[rownames(MS_test),colnames(MS_test)]
rank_score_cosine_zscore = rank_score(MS_test,MS_pred)
rank_score_cosine_zscore
# Web Accuracy 
# percent of vroot user visit in test data
sum(MS_test)/(dim(MS_test)[1]*dim(MS_test)[2])
# percent of vroot user visit in pred data
sum(MS_pred)/(dim(MS_pred)[1]*dim(MS_pred)[2])
# percent of vroot that the model predict and the user actually visit
sum((MS_test==MS_pred) & (MS_test==1))/sum(MS_test==1)
# MAE for Movie
movie_pred<-movie_pred_cosine_z_score
movie_pred<-movie_pred[rownames(movie_UI_test),colnames(movie_UI_test)]
mae(movie_UI_test,movie_pred)
```
#### mean-square difference Correlation
```{r}
# Rank of Score for Web
MS_pred<-MS_pred_msd_zscore
MS_pred<-MS_pred[rownames(MS_test),colnames(MS_test)]
rank_score_msd_zscore = rank_score(MS_test,MS_pred)
rank_score_msd_zscore
# Web Accuracy 
# percent of vroot user visit in test data
sum(MS_test)/(dim(MS_test)[1]*dim(MS_test)[2])
# percent of vroot user visit in pred data
sum(MS_pred)/(dim(MS_pred)[1]*dim(MS_pred)[2])
# percent of vroot that the model predict and the user actually visit
sum((MS_test==MS_pred) & (MS_test==1))/sum(MS_test==1)
# MAE for Movie
movie_pred<-movie_pred_msd_zscore
movie_pred<-movie_pred[rownames(movie_UI_test),colnames(movie_UI_test)]
mae(movie_UI_test,movie_pred)
```
#### Entropy Correlation
```{r}
# Rank of Score for Web
MS_pred<-MS_pred_entropy_zscore
MS_pred<-MS_pred[rownames(MS_test),colnames(MS_test)]
rank_score_entropy_zscore = rank_score(MS_test,MS_pred)
rank_score_entropy_zscore
# Web Accuracy 
# percent of vroot user visit in test data
sum(MS_test)/(dim(MS_test)[1]*dim(MS_test)[2])
# percent of vroot user visit in pred data
sum(MS_pred)/(dim(MS_pred)[1]*dim(MS_pred)[2])
# percent of vroot that the model predict and the user actually visit
sum((MS_test==MS_pred) & (MS_test==1))/sum(MS_test==1)
# MAE for Movie
movie_pred<-movie_pred_entropy_zscore
movie_pred<-movie_pred[rownames(movie_UI_test),colnames(movie_UI_test)]
mae(movie_UI_test,movie_pred)
```
